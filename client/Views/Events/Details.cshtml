@using System.Security.Claims
@model client.Models.Event

@{
    ViewData["Title"] = Model.Name;

    var DateStart = Model.Date.HasValue ? Model.Date.Value.ToString("dd.MM.yyyy HH:mm") : "";
    var DateEnd = Model.DateEnd.HasValue ? Model.DateEnd.Value.ToString("dd.MM.yyyy HH:mm") : "";
    bool active = Model.Active.HasValue ? Model.Active.Value : false;
}


<section class="container py-4">
    <div class="text-center">
        <img src="~/images/logo.png" alt="Logo" class="responsive-image" />
        <h1 class="mt-4">@Model.Name</h1>
    </div>
</section>

<section class="container py-3">
    <div class="row justify-content-center">
        <div class="col-sm-10 event-detail insert">
            @Html.Raw(Model.Description)
        </div>
    </div>
</section>

<section class="container py-3">
    <div class="row justify-content-center">
        <div class="col-sm-10 event-detail insert">
            @Html.Raw(Model.Program)



            <div class="table-responsive">
                <table class="table table-striped">
                    <tbody>
                        @foreach (var item in Model.Tickets)
                        {
                            <tr>
                                <td>@item.Description</td>
                                <td class="text-right">@item.Price?.ToString("0.00") €</td>
                                @if (User.Identity.IsAuthenticated)
                                {
                                    <td><a href="/MyTickets/Buy/@Model.EventId/@item.TicketId" class="btn btn-sm btn-success">Osta</a></td>
                                }
                            </tr>
                        }
                    </tbody>
                </table>
            </div>


            @if (active)
            {
                <div class="mt-3">
                    <div class="row">
                        <div class="col-12">
                            @if (User.Identity.IsAuthenticated)
                            {
                                <div class="mb-2">
                                    <a class="btn btn-sm btn-success" href="/MyTickets/Buy/@Model.EventId">Osta lippu tapahtumaan</a>
                                </div>

                                @if (User.HasClaim(c => c.Type == "IsAdmin" && c.Value == "True"))
                                {
                                    <div class="mb-2">
                                        <a class="btn btn-sm btn-outline-secondary" asp-action="Edit" asp-area="Admin" asp-route-id="@Model.EventId">Muokkaa tapahtumaa</a>
                                    </div>
                                    <div class="mb-2">
                                        <a class="btn btn-sm btn-outline-secondary" href="/Admin/Tickets/Index/@Model.EventId">Muokkaa/Luo lippuja</a>
                                    </div>
                                }
                            }
                            else
                            {
                                <div class="mb-2">
                                    <a class="btn btn-sm btn-success" href="/Auth/login">Kirjaudu ostaaksesi lippuja</a>
                                </div>
                            }
                        </div>
                    </div>
                </div>
            }



        </div>
    </div>
</section>
